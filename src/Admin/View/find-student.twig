{% extends 'layout.twig' %}

{% block body %}


        <div class="ui twelve column stackable center aligned page grid">
            <div class="ui container">

                     <h1 class="ui center aligned header">{{ dictionary.find_student }}</h1> <br>


                    <form method='post' id="form-student">
                        <div id='search-bar' class="ui left icon big fluid action input">
                            <input required pattern=".{3,}" title="3 characters minimum" type="text" id="student_name" name='name' placeholder="{{ dictionary.search }}...">
                            <i class="address book icon"></i>
                            <button id='search' class="ui submit button">{{ dictionary.search }}</button>
                            {{ csrf() }}
                        </div>
                    </form>

                    <br><br>
                    <div class="ui cards fluid" id="results"></div>
            </div>
        </div>

<script>
    $(function () {

        $('#search').on('click', function(e) {
            if ( $('#student_name').val().length > 2) {
                e.preventDefault();
                $('#search-bar').addClass('loading')
                $('#results').empty()
                $.ajax({
                    url: "{{ path('find-student') }}",
                    type: 'POST',
                    data: {
                        "csrf_name": $('[name="csrf_name"]').val(),
                        "csrf_value": $('[name="csrf_value"]').val(),
                        'name': $('#student_name').val()
                    },
                    success: function (response) {
                        $('#search-bar').removeClass('loading')
                        if (Object.keys(response).length < 1) {
                            $('#results').append(
                                $('<h1>').addClass('ui center aligned header').text('{{ dictionary.no_results }}')
                            )
                        } else {
                            $.each(response, function (k, v) {
                                var url = '{{ path('user-profile', {'id': 'user_id'}) }}';
                                url = url.replace("user_id", k);
                                $('#results').append(
                                    $('<div>').addClass('card').append(
                                        $('<div>').addClass('content').append(
                                            $('<div>').addClass('center aligned header').text(v),
                                            $('<div>').addClass('description').text('')
                                        ),
                                        $('<a>').prop('href', url).addClass('visit_profile').append(
                                            $('<div>').addClass('ui bottom attached button').append(
                                                $('<i>').addClass('user icon'), '{{ dictionary.visit_profile }}'
                                            )
                                        ).click(function() {
                                            $('#loader').addClass('active').transition('fade in')
                                        })
                                    )
                                ).transition('fade in')
                            })
                        }
                    },
                    fail: function (response) {
                        console.log('AJAX Call error')
                    }
                })
            }
        })

    })


</script>
{% endblock %}
